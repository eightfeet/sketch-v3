import{h as I,e as F,r as u,i as q,C as N,d as $,k as S,j as e}from"./index-8cbe7cbb.js";import{e as E,F as l,S as j,B as v,d as Y}from"./useDocumentTitle-ae3d75aa.js";import{l as h,T as f,I as x}from"./index-c1a1aac1.js";import{A as z}from"./avatar-e1a91e7a.js";import{F as B}from"./floating-bubble-16163208.js";import{u as M}from"./index-b2865fa6.js";const T="_root_1ai8a_1",V="_header_1ai8a_7",A="_wx_1ai8a_14",w={root:T,header:V,wx:A},R="_title_1mscq_1",W="_footer_1mscq_6",K="_iconbar_1mscq_11",b={title:R,footer:W,iconbar:K},O=({onHelp:r})=>{var p,_,g;const s=E(I),o=F();u.useEffect(()=>{s.member_id||o("/")},[o,s.member_id]);const i=l.useForm()[0];u.useEffect(()=>{var c,m,d,a;(c=s.info)!=null&&c.username&&i.setFieldValue("name",(m=s.info)==null?void 0:m.username),(d=s.info)!=null&&d.email&&i.setFieldValue("email",(a=s.info)==null?void 0:a.email)},[i,(p=s.info)==null?void 0:p.email,(_=s.info)==null?void 0:_.username]);const C=u.useCallback(async()=>{const{name:c,code:m,email:d}=i.getFieldsValue();try{h.show();const{code:a,data:t,msg:y,status:k}=await q(N.邀请码激活,{username:c,code:m,email:d,member_id:s.member_id});if(h.hide(),a!==200){let n=y;k===-3&&(n=`${n} 核销时间:${$(t.writeoff_at).format("YYYY-MM-DD HH:mm:ss")}`),t!=null&&t.extra&&(n=`${n} ${t==null?void 0:t.extra}`),y&&f.show(n||"");return}f.show("恭喜您激活成功！"),await S(s.member_id),o("/")}catch(a){console.error(a),f.show("激活失败"),h.hide()}},[i,o,s.member_id]);return e.jsxs(j,{direction:"vertical",block:!0,children:[e.jsx("h3",{className:b.title,children:"邀请码激活"}),e.jsxs(l,{form:i,onFinish:C,className:b.formbody,children:[e.jsx(l.Item,{label:e.jsxs(j,{block:!0,justify:"between",children:[e.jsx("span",{children:"邀请码"}),r?e.jsx(v,{size:"mini",fill:"outline",onClick:()=>r==null?void 0:r(),children:"获取邀请码"}):null]}),name:"code",rules:[{required:!0,message:"请输入邀请码"}],children:e.jsx(x,{placeholder:"请输入邀请码"})}),e.jsx(l.Item,{label:"用户名",name:"name",help:"唯一用户名用于激活产品",disabled:!!((g=s.info)!=null&&g.username),rules:[{required:!0,message:"请输入用户名"}],children:e.jsx(x,{placeholder:"请输入用户名"})}),e.jsx(l.Item,{label:"邮箱",name:"email",help:"用于收取产品序列号",rules:[{required:!0,message:"请输入邮箱号码"},{type:"string",min:6},{type:"email",warningOnly:!0}],children:e.jsx(x,{placeholder:"用于收取产品序列号"})})]}),e.jsx("div",{className:b.footer,children:e.jsx(v,{block:!0,type:"submit",color:"primary",size:"large",onClick:i.submit,children:"激活"})})]})},D=({name:r="邀请码激活"})=>{const s=F(),o=M();return Y(r),e.jsxs("div",{className:w.root,children:[e.jsxs(j,{block:!0,direction:"vertical",justify:"around",children:[e.jsx("div",{className:w.header,children:e.jsx(z,{src:"./logo512.png",style:{"--size":"64px"}})}),e.jsx(O,{onHelp:o})]}),e.jsx(B,{style:{"--initial-position-bottom":"24px","--initial-position-right":"24px","--edge-distance":"24px"},onClick:()=>s("/"),children:"首页"})]})},X=D;export{X as default};
