import{r as b,w as Q,R as m,c as L,m as oe,u as q,a as R,O as de,j as e,i as ee,C as te,T as A,h as se,e as ue,P as X,k as me,d as N,Q as he}from"./index-ce1eb5c4.js";import{B as V}from"./index-c23d8c1d.js";import{h as ae,a as U,i as fe,f as pe,j as be,b as xe,c as ye,D as ke,F as W,S,B as w,d as ve,e as je}from"./useDocumentTitle-c0da52a3.js";import{F as ge}from"./floating-bubble-d05ad2d7.js";import{u as we}from"./index-7201eb9a.js";import{l as C,I as Z}from"./index-70bdf6fd.js";function _e(n,l){const c=ae(n);U(()=>{const i=l.current;if(i)if(window.ResizeObserver){let o;const a=new ResizeObserver(()=>{o=window.requestAnimationFrame(()=>c(i))});return a.observe(i),()=>{window.cancelAnimationFrame(o),a.disconnect()}}else c(i)},[l])}function Ce(n,l,c){const i=ae(n);b.useEffect(()=>{const o=new MutationObserver(()=>{i()});if(l.current)return o.observe(l.current,c),()=>{o.disconnect()}},[l])}const H="adm-card",F=n=>{const l=()=>n.title||n.extra?m.createElement("div",{className:L(`${H}-header`,n.headerClassName),style:n.headerStyle,onClick:n.onHeaderClick},m.createElement("div",{className:`${H}-header-title`},n.title),n.extra):null,c=()=>n.children?m.createElement("div",{className:L(`${H}-body`,n.bodyClassName),style:n.bodyStyle,onClick:n.onBodyClick},n.children):null;return Q(n,m.createElement("div",{className:H,onClick:n.onClick},l(),c()))};const u="adm-tabs",Me=()=>null,Ne={activeLineMode:"auto",stretch:!0},Le=n=>{var l;const c=oe(Ne,n),i=b.useRef(null),o=b.useRef(null),a={};let x=null;const _=[];fe(c.children,(s,r)=>{if(!b.isValidElement(s))return;const k=s.key;if(typeof k!="string")return;r===0&&(x=k);const M=_.push(s);a[k]=M-1});const[h,$]=pe({value:c.activeKey,defaultValue:(l=c.defaultActiveKey)!==null&&l!==void 0?l:x,onChange:s=>{var r;s!==null&&((r=c.onChange)===null||r===void 0||r.call(c,s))}}),[{x:j,width:y},f]=q(()=>({x:0,width:0,config:{tension:300,clamp:!0}})),[{scrollLeft:z},E]=q(()=>({scrollLeft:0,config:{tension:300,clamp:!0}})),[{leftMaskOpacity:T,rightMaskOpacity:t},d]=q(()=>({leftMaskOpacity:0,rightMaskOpacity:0,config:{clamp:!0}}));function p(s=!1){const r=i.current;if(!r)return;const k=a[h];if(k===void 0){f.start({x:0,width:0,immediate:!0});return}const M=o.current;if(!M)return;const Y=r.children.item(k+1),G=Y.children.item(0),I=G.offsetLeft,K=G.offsetWidth,re=Y.offsetLeft,ne=Y.offsetWidth,P=r.offsetWidth,J=r.scrollWidth,ce=r.scrollLeft,le=M.offsetWidth;let D=0,B=0;if(c.activeLineMode==="auto"?(D=I,B=K):c.activeLineMode==="full"?(D=re,B=ne):D=I+(K-le)/2,f.start({x:D,width:B,immediate:s}),J-P<=0)return;const ie=xe(I-(P-K)/2,0,J-P);E.start({scrollLeft:ie,from:{scrollLeft:ce},immediate:s})}U(()=>{p(!j.isAnimating)},[]),be(()=>{p()},[h]),_e(()=>{p(!j.isAnimating)},i),Ce(()=>{p(!j.isAnimating)},i,{subtree:!0,childList:!0,characterData:!0});const{run:g}=we((s=!1)=>{const r=i.current;if(!r)return;const k=r.scrollLeft,M=k>0,Y=k+r.offsetWidth<r.scrollWidth;d.start({leftMaskOpacity:M?1:0,rightMaskOpacity:Y?1:0,immediate:s})},{wait:100,trailing:!0,leading:!0});return U(()=>{g(!0)},[]),Q(c,m.createElement("div",{className:u},m.createElement("div",{className:`${u}-header`},m.createElement(R.div,{className:L(`${u}-header-mask`,`${u}-header-mask-left`),style:{opacity:T}}),m.createElement(R.div,{className:L(`${u}-header-mask`,`${u}-header-mask-right`),style:{opacity:t}}),m.createElement(R.div,{className:`${u}-tab-list`,ref:i,scrollLeft:z,onScroll:g,role:"tablist"},m.createElement(R.div,{ref:o,className:`${u}-tab-line`,style:{width:c.activeLineMode==="fixed"?"var(--fixed-active-line-width, 30px)":y,x:j}}),_.map(s=>Q(s.props,m.createElement("div",{key:s.key,className:L(`${u}-tab-wrapper`,{[`${u}-tab-wrapper-stretch`]:c.stretch})},m.createElement("div",{onClick:()=>{const{key:r}=s;s.props.disabled||r!=null&&$(r.toString())},className:L(`${u}-tab`,{[`${u}-tab-active`]:s.key===h,[`${u}-tab-disabled`]:s.props.disabled}),role:"tab","aria-selected":s.key===h},s.props.title)))))),_.map(s=>{if(s.props.children===void 0)return null;const r=s.key===h;return m.createElement(de,{key:s.key,active:r,forceRender:s.props.forceRender,destroyOnClose:s.props.destroyOnClose},m.createElement("div",{className:`${u}-content`,style:{display:r?"block":"none"}},s.props.children))})))},O=ye(Le,{Tab:Me}),$e="_root_ftacp_1",Ee="_header_ftacp_6",Ye="_tab_ftacp_13",Te="_wrap_ftacp_18",De="_wran_ftacp_23",Re="_nodata_ftacp_27",We="_progress_ftacp_34",He="_sharebox_ftacp_41",v={root:$e,header:Ee,tab:Ye,wrap:Te,wran:De,nodata:Re,progress:We,sharebox:He},Fe={},Oe=({onCancel:n,member_id:l,openid:c,username:i,email:o,onSuccess:a})=>{const x=W.useForm()[0];b.useEffect(()=>{x.setFieldsValue({username:i,email:o})},[i,o,x]);const _=b.useCallback(async({username:h,email:$})=>{C.show();const{code:j,data:y,msg:f}=await ee(te.更新会员,{username:h,email:$,member_id:l,openid:c});j===200?(A.show("提交成功！"),se.info=y,a==null||a(y)):A.show(f||"请求失败！"),C.hide()},[l,a,c]);return e.jsx("div",{children:e.jsxs(W,{form:x,onFinish:_,className:Fe.formbody,footer:e.jsxs(S,{block:!0,direction:"vertical",children:[e.jsx(w,{block:!0,color:"primary",onClick:x.submit,children:"确定"}),n?e.jsx(w,{block:!0,onClick:n,children:"取消"}):null]}),children:[e.jsx(W.Item,{label:"用户名",name:"username",disabled:!!i,rules:[{required:!0,message:"请输入用户名"}],children:e.jsx(Z,{placeholder:"请输入用户名"})}),e.jsx(W.Item,{label:"邮箱",name:"email",rules:[{required:!0,message:"请输入邮箱号码"},{type:"string",min:6},{type:"email",warningOnly:!0}],children:e.jsx(Z,{placeholder:"用于收取产品序列号"})})]})})},Se=({member_id:n,openid:l,email:c,username:i,onSuccess:o})=>{const a=ke.show({title:"完善用户信息",content:e.jsx(Oe,{member_id:n,openid:l,email:c,username:i,onSuccess:x=>{a.close(),o==null||o(x)},onCancel:()=>a.close()})})},Ae="https://www.eightfeet.cn/sketch-v3/assets/share-88d2c64b.png",ze=({name:n="任务中心"})=>{const l=ue();ve(n);const{tasks:c,info:i={},member_id:o}=je(se),{achieving:a,oldAchieved:x=[],newAchieved:_=[]}=c||{},[h,$]=b.useState("all"),[j,y]=b.useState(!1),f=[..._,...x];b.useEffect(()=>{o||l("/")},[o,l]);const z=b.useCallback(async t=>{C.show();try{await X({member_id:o}),$(t),C.hide()}catch(d){C.hide();try{A.show(d.meg)}catch(p){console.error(p)}}},[o]),E=b.useCallback(async({member_id:t,task_id:d,username:p,email:g})=>{C.show();const{code:s,msg:r}=await ee(te.任务转换为序列号,{member_id:t,task_id:d,username:p,email:g});await X({member_id:t}),C.hide(),s!==200&&A.show(r||"领取任务失败"),await me(t)},[]),T=b.useCallback(t=>async()=>{const{member_id:d,username:p,email:g,openid:s}=i;if(!g||!p){Se({username:p,email:g,member_id:d,openid:s,onSuccess:r=>{E({member_id:d,username:r.username,email:r.email,task_id:t.task_id})}});return}E({member_id:d,username:p,email:g,task_id:t.task_id})},[i,E]);return e.jsxs("div",{className:v.root,children:[e.jsxs(O,{className:v.tab,activeKey:h,onChange:z,children:[e.jsx(O.Tab,{title:"任务"},"all"),e.jsx(O.Tab,{title:"已达成"},"achieved"),e.jsx(O.Tab,{title:e.jsx(V,{color:"#ff9800",content:h==="process"?null:(a==null?void 0:a.length)||null,children:"进行中"})},"process")]}),e.jsxs("div",{className:v.wrap,children:[h==="all"?e.jsxs(S,{block:!0,direction:"vertical",justify:"around",children:[[...f].map((t,d)=>e.jsxs(F,{title:t.name,extra:t.exchange?e.jsx(w,{size:"mini",disabled:!0,color:"primary",children:"已领取"}):e.jsx(w,{size:"mini",color:"primary",onClick:T(t),children:"领取"}),children:[t.describes,t.end_at?e.jsxs("p",{style:{color:"var(--adm-color-primary)"},children:["活动截止日期：",N(t.end_at).format("YYYY-MM-DD HH:ss:mm")]}):null,t.exchange?e.jsxs("p",{children:["领取时间：",N(t.exchange_at).format("YYYY-MM-DD HH:ss:mm")]}):null]},d)),a==null?void 0:a.map((t,d)=>e.jsxs(F,{title:t.name,extra:e.jsx("span",{className:v.progress,children:e.jsx(V,{content:`${t.achieved||0} / ${t.target}`,children:e.jsx(w,{size:"mini",color:"success",onClick:()=>y(!0),children:"去完成"})})}),children:[t.describes,t.end_at?e.jsxs("p",{style:{color:"var(--adm-color-primary)"},children:["活动截止日期：",N(t.end_at).format("YYYY-MM-DD HH:ss:mm")]}):null]},`b_${d}`)),!(f!=null&&f.length)&&!(a!=null&&a.length)?e.jsx("div",{className:v.nodata,children:"暂无活动"}):null]}):null,h==="achieved"?e.jsxs(S,{block:!0,direction:"vertical",justify:"around",children:[f.map((t,d)=>e.jsxs(F,{title:t.name,extra:t.exchange?e.jsx(w,{size:"mini",disabled:!0,color:"primary",children:"已领取"}):e.jsx(w,{size:"mini",color:"primary",onClick:T(t),children:"领取"}),children:[t.describes,t.end_at?e.jsxs("p",{style:{color:"var(--adm-color-primary)"},children:["活动截止日期：",N(t.end_at).format("YYYY-MM-DD HH:ss:mm")]}):null,t.exchange?e.jsxs("p",{children:["领取时间：",N(t.exchange_at).format("YYYY-MM-DD HH:ss:mm")]}):null]},d)),f!=null&&f.length?null:e.jsx("div",{className:v.nodata,children:"暂无活动"})]}):null,h==="process"?e.jsxs(S,{block:!0,direction:"vertical",justify:"around",children:[a==null?void 0:a.map((t,d)=>e.jsxs(F,{title:t.name,extra:e.jsx("span",{className:v.progress,children:e.jsx(V,{content:`${t.achieved||0} / ${t.target}`,children:e.jsx(w,{size:"mini",color:"success",onClick:()=>y(!0),children:"去完成"})})}),children:[t.describes,t.end_at?e.jsxs("p",{style:{color:"var(--adm-color-primary)"},children:["活动截止日期：",N(t.end_at).format("YYYY-MM-DD HH:ss:mm")]}):null]},d)),a!=null&&a.length?null:e.jsx("div",{className:v.nodata,children:"暂无活动"})]}):null]}),e.jsx(ge,{style:{"--initial-position-bottom":"24px","--initial-position-right":"24px","--edge-distance":"24px"},onClick:()=>l("/"),children:"首页"}),e.jsx(he,{visible:j,opacity:.8,onMaskClick:()=>y(!1),children:e.jsx("div",{className:v.sharebox,children:e.jsx("img",{src:Ae,alt:"分享",onClick:()=>y(!1)})})})]})},Ue=ze;export{Ue as default};
